{% extends 'base.html' %}
{% load static %}
{% load payment_extras %}

{% block extra_head %}
<style>
    #tables {
        max-height: 70vh;
        overflow-y: auto;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 1200px;">
    <div class="fixed-container  ">
    <!------------------------------------ Dashboard Header ------------------------------------>
    
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-speedometer2"></i> Dashboard</h2> 
        <h4>Welcome, {{request.user.first_name|default:"Manager"}}</h4>
    </div>

    <!--------------------------------------Summary Cards ----------------------------------------->

    <div class="row text-center mb-4">
        <div class="col-md mb-1">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h5><i class="bi bi-house-door"></i> Total Properties</h5> <h2>{{ total_properties }}</h2>
                    
                    <button 
                        class="btn btn-success btn-sm mt-2 ms-2"
                        hx-get="{% url 'register_property' %}"
                        hx-target="#tables"
                        hx-trigger="click"
                        hx-swap="innerHTML"
                        >
                        <i class="bi bi-plus-circle"></i> Add Property
                    </button>
                    <!-- Load Properties Button -->
                    <button 
                        class="btn btn-outline-light btn-sm mt-2"
                        hx-get="{% url 'property_list' %}"
                        hx-target="#tables"
                        hx-swap="innerHTML"
                        hx-push-url="{% url 'property_list' %}">
                        View Property List
                    </button>

                </div>
            </div>
        </div>
    <div class="col-md mb-1">
        <div class="card bg-success text-white">
            <div class="card-body ">
                <h5><i class="bi bi-people"></i> Total Tenants</h5> 
                <h2>{{ total_tenants }}</h2>
                
                <button
                    class="btn btn-outline-warning btn-sm mt-2"
                    hx-get="{% url 'register_tenant' %}"
                    hx-target="#tables"
                    hx-trigger="click"
                    hx-swap="innerHTML">
                    <i class="bi bi-person-plus"></i> Register Tenant
                </button>
                <button
                    class="btn btn-primary btn-sm mt-2"
                    hx-get="{% url 'tenant_list' %}"
                    hx-target="#tables"
                    hx-trigger="click"
                    hx-swap="innerHTML"
                    >
                    <i class="bi bi-list-ul"></i> View Tenants
                </button>

            </div>
        </div>
    </div>
    <div class="col-md">
        <div class="card bg-warning text-dark">
            <div class="card-body ">
                <h5><i class="bi bi-exclamation-triangle"></i> Open Issues</h5>
                <h2>{{ open_issues }}</h2>
                <span class="btn btn-sm btn-danger"><i class="bi bi-exclamation-circle"></i> Open {{ open_issues }}</span>
                <span class="btn btn-sm btn-secondary"><i class="bi bi-hourglass-split"></i> In Progress {{ in_progress_issues }}</span>
                <span class="btn btn-sm btn-success"><i class="bi bi-check-circle"></i> Resolved {{ resolved_issues }}</span>
            </div>
        </div>
    </div>
</div>

<!------------------------------------- Issues Summary ------------------------------------------>

    <div class="mb-1">
        <button  class="btn btn-primary btn-sm mt-2" 
            hx-get="{% url 'register_property_owner' %}" 
            hx-target="#tables" 
            hx-trigger="click" 
            hx-swap="innerHTML"
            >
        + Register Property Owner<i class="bi bi-person-badge"></i>
        </button>
        <button class="btn btn-outline-success btn-sm mt-2"
                hx-get="{% url 'issue_history' %}"
                hx-target="#tables"
                hx-swap="innerHTML"
        ><i class="bi bi-clock-history"></i> View Full Issue History</i>
        </button >
            
        <button 
            class="btn btn-info btn-sm mt-2" 
            hx-get="{% url 'create_manager' %}" 
            hx-target="#tables"
            hx-trigger="click"
            hx-swap="innerHTML">
            <i class="bi bi-person-plus"></i> Add Manager
        </button>
    </div>
        
    <!------------------------------------------ Recent Issues Table--------------------------------->
            
        <div  class="container" id="tables">
            <div class="row">
                <div class="col-md-12">
                    {% include 'dashboard/partials/_dashboard_tables.html' %}
                </div>
            </div>
        </div>
</div>

{% endblock %}



